package com.java.training.multithreads;

public class AccountHolder implements Runnable {
	private Account account;
	int withdrawAmount;
	
	public AccountHolder(Account account, int amount) {
		this.account = account;
		this.withdrawAmount = amount;
	}
	
	public synchronized void run() {
		for(int i=1; i<=1;i++) {
			System.out.println(account.getBalance());

			if(account.getBalance() < 0) { //never runs this statement
											//how do i make this statement run?
				System.out.println("Your ACcount is Overdrwan");
			}
			else if(account.getBalance() <= 1000 && account.getBalance() >=1){ //why is this statement not running??
				System.out.println("low balance please deposit soon!!!");
			}
			else {
				makewithdrawal(withdrawAmount); 
			}
			
		}
		
	}
	
	//without synchronization 
	//"synchronized" put this word between public and void 
	//i think I don't need the thrad safety if the amount is less then 3000 
	//why? 
	//if the threads are async then the total balance will be wrong 
	
	//Deadlock occured: 
	//there is no need of wait and notify since there is no diffrent processes running simotaniously so if you put them in here it will create a deadlock 
	
	public synchronized void makewithdrawal(int withdrawAmount) {
		if(account.getBalance() >= withdrawAmount) {
			System.out.println(Thread.currentThread().getName() +" is going to withdraw " + withdrawAmount); //the program comes till here and stops 
			try {
//				wait();
				Thread.sleep(10);
				  
			} catch(InterruptedException ex) {
				
			}
			
			account.withdraw(withdrawAmount);
			System.out.println(Thread.currentThread().getName() +" Completes the withdrawal of  " + withdrawAmount);
			System.out.println("Available Balance" + account.getBalance()); //the loop run the the get balance after it completes the transation
			

		} else {
			System.out.println("Withdraw Ammount: " + withdrawAmount);
			System.out.println("Not enough in Account for " + Thread.currentThread().getName() +" to withdraw " + account.getBalance());

		}
		notify();

	}

}
